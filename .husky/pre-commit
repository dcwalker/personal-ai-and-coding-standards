#!/bin/sh
set -e

# Check for eslint-disable comments
echo "Checking for eslint-disable comments..."
DISABLED_RULES=$(find . -type f \( -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx" \) \
  ! -path "*/node_modules/*" \
  ! -path "*/static/dist/*" \
  ! -path "*/reports/*" \
  ! -path "*/.git/*" \
  -exec grep -Hn "eslint-disable" {} + 2>/dev/null || true)

if [ -n "$DISABLED_RULES" ]; then
  echo "Error: eslint-disable comments found. Please remove them before committing:"
  echo ""
  echo "$DISABLED_RULES"
  exit 1
fi

# Run linting on staged files
yarn lint:staged

# Run unit tests with coverage validation
echo "Running backend unit tests with coverage validation..."
yarn test:cov

# Run frontend unit tests with coverage validation
echo "Running frontend unit tests with coverage validation..."
yarn test:cov:frontend

